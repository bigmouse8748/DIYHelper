<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Picks - Curated DIY Products</title>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #f44336;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            line-height: 1.6;
        }

        .hero {
            background: var(--background-gradient);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .filters-section {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .filter-select, .filter-input, .filter-range {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .filter-select:focus, .filter-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .products-count {
            color: #666;
            font-size: 1rem;
        }

        .sort-options {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sort-select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .product-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .product-image-container {
            position: relative;
            width: 100%;
            height: 220px;
            overflow: hidden;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .featured-badge {
            background: gold;
            color: #333;
        }

        .discount-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--error-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .product-content {
            padding: 25px;
        }

        .product-brand {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .current-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--success-color);
        }

        .original-price {
            font-size: 1rem;
            color: #999;
            text-decoration: line-through;
        }

        .discount-percent {
            background: var(--error-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .stars {
            color: #ffc107;
            font-size: 1rem;
        }

        .rating-text {
            color: #666;
            font-size: 0.9rem;
        }

        .product-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 20px;
        }

        .category-tag {
            background: #f0f0f0;
            color: #666;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn-buy {
            flex: 1;
            background: var(--success-color);
            color: white;
            padding: 12px;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-buy:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-details {
            padding: 12px 16px;
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-details:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .retailer-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .retailer-logo {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 60px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 40px;
        }

        .pagination button {
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .pagination button:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .pagination button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .no-products {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .no-products h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .featured-section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 2rem;
            color: #333;
            font-weight: 600;
        }

        .section-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .filters-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .products-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .products-header {
                flex-direction: column;
                align-items: stretch;
            }

            .section-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav style="background: rgba(102, 126, 234, 0.1); padding: 15px 20px; margin-bottom: 0;">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
            <a href="index.html" style="display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: var(--primary-color); font-weight: 600; font-size: 1rem;" id="backToHome">
                ← Back to Home
            </a>
            
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <h1 id="heroTitle">🛒 Our Picks</h1>
        <p id="heroSubtitle">Curated DIY products selected by experts. Find the best tools, materials, and equipment for your next project.</p>
    </div>

    <div class="container">
        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label" id="categoryLabel">Category</label>
                    <select id="filterCategory" class="filter-select">
                        <option value="" id="allCategories">All Categories</option>
                        <option value="power_tools">Power Tools</option>
                        <option value="hand_tools">Hand Tools</option>
                        <option value="safety_equipment">Safety Equipment</option>
                        <option value="building_materials">Building Materials</option>
                        <option value="hardware">Hardware</option>
                        <option value="plumbing">Plumbing</option>
                        <option value="electrical">Electrical</option>
                        <option value="automotive">Automotive</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label" id="retailerLabel">Retailer</label>
                    <select id="filterRetailer" class="filter-select">
                        <option value="" id="allRetailers">All Retailers</option>
                        <option value="amazon">Amazon</option>
                        <option value="home_depot">Home Depot</option>
                        <option value="lowes">Lowes</option>
                        <option value="walmart">Walmart</option>
                        <option value="target">Target</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label" id="priceRangeLabel">Price Range</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                        <input type="number" id="minPrice" class="filter-input" placeholder="Min $" min="0" data-placeholder="Min $">
                        <input type="number" id="maxPrice" class="filter-input" placeholder="Max $" min="0" data-placeholder="Max $">
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Minimum Rating</label>
                    <select id="minRating" class="filter-select">
                        <option value="">Any Rating</option>
                        <option value="4.5">4.5+ Stars</option>
                        <option value="4.0">4.0+ Stars</option>
                        <option value="3.5">3.5+ Stars</option>
                        <option value="3.0">3.0+ Stars</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Project Type</label>
                    <select id="filterProjectType" class="filter-select">
                        <option value="">All Projects</option>
                        <option value="woodworking">Woodworking</option>
                        <option value="plumbing">Plumbing</option>
                        <option value="electrical">Electrical</option>
                        <option value="automotive">Automotive</option>
                        <option value="metalworking">Metalworking</option>
                        <option value="painting">Painting</option>
                        <option value="general">General</option>
                        <option value="outdoor">Outdoor</option>
                        <option value="home_improvement">Home Improvement</option>
                        <option value="crafts">Crafts</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Search</label>
                    <input type="text" id="filterSearch" class="filter-input" placeholder="Search products...">
                </div>
            </div>

            <div class="filter-actions">
                <button class="btn btn-secondary" onclick="clearFilters()">🔄 Clear All Filters</button>
            </div>
        </div>

        <!-- Featured Products Section -->
        <div id="featuredSection" class="featured-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">⭐ Featured Products</h2>
            </div>
            <div id="featuredProducts" class="products-grid">
                <!-- Featured products will be loaded here -->
            </div>
        </div>

        <!-- All Products Section -->
        <div class="section-header">
            <h2 class="section-title" id="allProductsTitle">🛍️ All Products</h2>
            <p class="section-subtitle" id="allProductsSubtitle">Browse our complete collection of curated DIY products</p>
        </div>

        <!-- Products Header -->
        <div class="products-header">
            <div class="products-count" id="productsCount">
                <span id="loadingText">Loading products...</span>
            </div>
            
            <div class="sort-options">
                <span id="sortByLabel">Sort by:</span>
                <select id="sortBy" class="sort-select" onchange="applyFilters()">
                    <option value="rating" id="highestRated">Highest Rated</option>
                    <option value="price" id="priceLowHigh">Price: Low to High</option>
                    <option value="created_at" id="newestFirst">Newest First</option>
                    <option value="title" id="nameAZ">Name A-Z</option>
                </select>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading" id="productsLoading">
            <div class="spinner"></div>
            <p id="loadingCuratedText">Loading curated products...</p>
        </div>

        <!-- Products Grid -->
        <div id="productsGrid" class="products-grid">
            <!-- Products will be loaded here -->
        </div>

        <!-- No Products Message -->
        <div id="noProducts" class="no-products" style="display: none;">
            <h3 id="noProductsTitle">No products found</h3>
            <p>Try adjusting your filters to see more results.</p>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="pagination">
            <!-- Pagination will be generated here -->
        </div>
    </div>

    <script>

        const API_BASE = 'http://localhost:8000';
        let currentPage = 1;
        let currentFilters = {};

        // Load products on page load
        document.addEventListener('DOMContentLoaded', () => {
            
            loadProducts();
            loadFeaturedProducts();
            
            // Add event listeners to all filter controls for real-time filtering
            document.getElementById('filterCategory').addEventListener('change', applyFilters);
            document.getElementById('filterRetailer').addEventListener('change', applyFilters);
            document.getElementById('minPrice').addEventListener('input', debounce(applyFilters, 800));
            document.getElementById('maxPrice').addEventListener('input', debounce(applyFilters, 800));
            document.getElementById('minRating').addEventListener('change', applyFilters);
            document.getElementById('filterProjectType').addEventListener('change', applyFilters);
            document.getElementById('filterSearch').addEventListener('input', debounce(applyFilters, 500));
        });

        // Load featured products
        async function loadFeaturedProducts() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/our-picks/public/products?is_featured=true&page_size=6`);
                const result = await response.json();

                if (result.success && result.products.length > 0) {
                    document.getElementById('featuredSection').style.display = 'block';
                    displayProducts(result.products, 'featuredProducts');
                }
            } catch (error) {
                console.error('Failed to load featured products:', error);
            }
        }

        // Load products with current filters
        async function loadProducts(page = 1) {
            const loading = document.getElementById('productsLoading');
            const grid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');
            const pagination = document.getElementById('pagination');

            loading.classList.add('show');
            grid.innerHTML = '';
            noProducts.style.display = 'none';
            pagination.innerHTML = '';

            // Build query parameters
            const params = new URLSearchParams({
                page: page,
                page_size: 20,
                sort_by: document.getElementById('sortBy').value || 'rating',
                sort_order: document.getElementById('sortBy').value === 'price' ? 'asc' : 'desc',
                ...currentFilters
            });

            try {
                const response = await fetch(`${API_BASE}/api/v1/our-picks/public/products?${params}`);
                const result = await response.json();

                loading.classList.remove('show');

                if (result.success && result.products) {
                    if (result.products.length === 0) {
                        noProducts.style.display = 'block';
                    } else {
                        displayProducts(result.products, 'productsGrid');
                        displayPagination(result.page, Math.ceil(result.total_count / result.page_size), result.total_count);
                        currentPage = result.page;
                    }

                    // Update products count
                    document.getElementById('productsCount').textContent = 
                        `Showing ${result.products.length} of ${result.total_count} products`;
                } else {
                    noProducts.style.display = 'block';
                    document.getElementById('productsCount').textContent = 'No products found';
                }

            } catch (error) {
                loading.classList.remove('show');
                noProducts.style.display = 'block';
                document.getElementById('productsCount').textContent = 'Failed to load products';
                console.error('Load products error:', error);
            }
        }

        // Display products in grid
        function displayProducts(products, containerId) {
            const container = document.getElementById(containerId);
            
            container.innerHTML = products.map(product => {
                // Generate star rating
                const fullStars = Math.floor(product.rating || 0);
                const hasHalfStar = (product.rating || 0) % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                const starsHTML = '★'.repeat(fullStars) + 
                                 (hasHalfStar ? '☆' : '') + 
                                 '☆'.repeat(emptyStars);

                // Generate category tags if suitable_projects exists
                let categoriesHTML = '';
                try {
                    const projects = JSON.parse(product.suitable_projects || '[]');
                    if (projects.length > 0) {
                        categoriesHTML = projects.slice(0, 3).map(proj => 
                            `<span class="category-tag">${proj.replace('_', ' ')}</span>`
                        ).join('');
                    }
                } catch (e) {
                    // If JSON parsing fails, show category
                    categoriesHTML = `<span class="category-tag">${product.category.replace('_', ' ')}</span>`;
                }

                return `
                    <div class="product-card">
                        <div class="product-image-container">
                            ${product.image_url ? 
                                `<img src="${product.image_url}" alt="${product.title}" class="product-image" 
                                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'320\\' height=\\'220\\'%3E%3Crect width=\\'100%25\\' height=\\'100%25\\' fill=\\'%23f0f0f0\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' dominant-baseline=\\'central\\' text-anchor=\\'middle\\' fill=\\'%23999\\'%3ENo Image%3C/text%3E%3C/svg%3E'">` :
                                `<div class="product-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #999; font-size: 1.2rem;">No Image Available</div>`
                            }
                            ${product.category ? `<div class="product-badge">${product.category.replace('_', ' ').toUpperCase()}</div>` : ''}
                            ${product.is_featured ? '<div class="product-badge featured-badge">⭐ FEATURED</div>' : ''}
                            ${product.discount_percentage > 0 ? `<div class="discount-badge">-${product.discount_percentage}%</div>` : ''}
                        </div>

                        <div class="product-content">
                            <div class="product-brand">${product.brand || 'Unknown Brand'}</div>
                            <h3 class="product-title">${product.title}</h3>
                            <p class="product-description">${product.description || 'No description available'}</p>

                            <div class="retailer-info">
                                <span>🏪</span>
                                <span>Available at ${product.retailer.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                            </div>

                            ${product.rating > 0 ? `
                                <div class="product-rating">
                                    <div class="stars">${starsHTML}</div>
                                    <span class="rating-text">${product.rating}/5 (${product.review_count || 0} reviews)</span>
                                </div>
                            ` : ''}

                            <div class="product-price">
                                <span class="current-price">$${product.price}</span>
                                ${product.original_price && product.original_price > product.price ? 
                                    `<span class="original-price">$${product.original_price}</span>
                                     <span class="discount-percent">-${product.discount_percentage}%</span>` : ''
                                }
                            </div>

                            <div class="product-categories">
                                ${categoriesHTML}
                            </div>

                            <div class="product-actions">
                                <a href="${product.affiliate_link}" target="_blank" rel="noopener" 
                                   class="btn-buy" onclick="trackClick('${product.id}')">
                                    🛒 Buy Now
                                </a>
                                <button class="btn-details" onclick="showProductDetails('${product.id}')">
                                    ℹ️
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Display pagination
        function displayPagination(currentPage, totalPages, totalCount) {
            const container = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button onclick="loadProducts(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>← Previous</button>`;

            // Page numbers (show max 7 pages)
            let startPage = Math.max(1, currentPage - 3);
            let endPage = Math.min(totalPages, startPage + 6);
            
            if (endPage - startPage < 6) {
                startPage = Math.max(1, endPage - 6);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="${i === currentPage ? 'active' : ''}" onclick="loadProducts(${i})">${i}</button>`;
            }

            // Next button
            paginationHTML += `<button onclick="loadProducts(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next →</button>`;

            container.innerHTML = paginationHTML;
        }

        // Apply filters
        function applyFilters() {
            currentFilters = {};

            // Collect all filter values
            const category = document.getElementById('filterCategory').value;
            if (category) currentFilters.category = category;

            const retailer = document.getElementById('filterRetailer').value;
            if (retailer) currentFilters.retailer = retailer;

            const minPrice = document.getElementById('minPrice').value;
            if (minPrice) currentFilters.min_price = parseFloat(minPrice);

            const maxPrice = document.getElementById('maxPrice').value;
            if (maxPrice) currentFilters.max_price = parseFloat(maxPrice);

            const minRating = document.getElementById('minRating').value;
            if (minRating) currentFilters.min_rating = parseFloat(minRating);

            const projectType = document.getElementById('filterProjectType').value;
            if (projectType) currentFilters.project_type = projectType;

            const search = document.getElementById('filterSearch').value;
            if (search) currentFilters.search = search;

            // Reload products with filters
            loadProducts(1);
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterRetailer').value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.getElementById('minRating').value = '';
            document.getElementById('filterProjectType').value = '';
            document.getElementById('filterSearch').value = '';

            currentFilters = {};
            loadProducts(1);
        }

        // Track affiliate link clicks
        async function trackClick(productId) {
            try {
                await fetch(`${API_BASE}/api/v1/our-picks/track-click/${productId}`, {
                    method: 'POST'
                });
            } catch (error) {
                console.error('Failed to track click:', error);
            }
        }

        // Show product details (placeholder function)
        function showProductDetails(productId) {
            alert('Product details feature coming soon!');
            // TODO: Implement product details modal or page
        }

        // Debounce function to limit API calls
        function debounce(func, delay) {
            let timeoutId;
            return function (...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        }
    
        // Listen for language changes from dashboard
        window.addEventListener('storage', function(e) {
            
        });
    
        // Listen for language changes from dashboard
        window.addEventListener('storage', function(e) {
            console.log('Storage event detected:', e.key, e.newValue);
            
        });
    </script>
</body>
</html>